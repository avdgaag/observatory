<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Observatory::Observer
  
    &mdash; Observatory
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (O)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Observatory.html" title="Observatory (module)">Observatory</a></span></span>
     &raquo; 
    <span class="title">Observer</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Observatory::Observer
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/observatory/observer.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong> 
    <div class='inline'><p>allow registering a single method to mulitple signals, or even
matching by regular expression...?</p></div>
  </div>

  <div class="note todo">
    <strong>TODO:</strong> 
    <div class='inline'><p>this is pretty magicky. Might need to refactor to make things more
explicit and obvious.</p></div>
  </div>


  <div class="note notetag">
    <strong>Note:</strong> 
    <div class='inline'><p>Including the Observer module in your object will override your
initializer.</p></div>
  </div>

<p>The Observer module enhances your classes with some simple syntactic sugar
to register methods as observers. You may very well register your
methods manually, but these methods may increase your code readability.</p>

<p>This module will override your <code>initialize</code> method to automatically
register all observer methods with the dispatcher. In order to do so,
it will alias your own <code>initialize</code> method and create a new one that
both calls the old initializer and registers observers. This does mean
that your initializer needs to set up a dispatcher object, probably
via constructor dependency injection.</p>

<p>The main benefit of using this module in your classes is you get the
class macro <code>observe</code> which will set up the next method that is declared
in the class as an observer for the given signal name.</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>Registering a method as an observer for a signal</p></div></h4>
      <pre class="example code"><span class='class class kw'>class</span> <span class='Logger constant id'>Logger</span>
  <span class='include identifier id'>include</span> <span class='Observatory constant id'>Observatory</span><span class='colon2 op'>::</span><span class='Observer constant id'>Observer</span>

  <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='dispatcher identifier id'>dispatcher</span><span class='rparen token'>)</span>
    <span class='@dispatcher ivar id'>@dispatcher</span> <span class='assign token'>=</span> <span class='dispatcher identifier id'>dispatcher</span>
  <span class='end end kw'>end</span>

  <span class='observe identifier id'>observe</span> <span class='string val'>'post.publish'</span>
  <span class='def def kw'>def</span> <span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='event identifier id'>event</span><span class='rparen token'>)</span>
    <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Event #{event.signal} happened at #{Time.now}&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    
  </div>

</div><h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Observer/ClassMethods.html" title="Observatory::Observer::ClassMethods (module)">ClassMethods</a></span>
    
   
    
  
</p>





  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#included-class_method" title="included (class method)">+ (Object) <strong>included</strong>(base) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="included-class_method">
  
    + (<tt>Object</tt>) <strong>included</strong>(base) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/observatory/observer.rb', line 39</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='included identifier id'>included</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span>
  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='extend identifier id'>extend</span> <span class='ClassMethods constant id'>ClassMethods</span>
  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='overwrite_initialize identifier id'>overwrite_initialize</span>
  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='class_eval identifier id'>class_eval</span> <span class='do do kw'>do</span>
    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:dispatcher</span>
  <span class='end end kw'>end</span>

  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='instance_eval identifier id'>instance_eval</span> <span class='do do kw'>do</span>
    <span class='def def kw'>def</span> <span class='method_added identifier id'>method_added</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='name identifier id'>name</span> <span class='eq op'>==</span> <span class='symbol val'>:initialize</span>
        <span class='overwrite_initialize identifier id'>overwrite_initialize</span>
      <span class='else else kw'>else</span>
        <span class='if if kw'>if</span> <span class='@observer_next_event_name_to_observe ivar id'>@observer_next_event_name_to_observe</span>
          <span class='@observers_to_set_up ivar id'>@observers_to_set_up</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
          <span class='@observers_to_set_up ivar id'>@observers_to_set_up</span><span class='lbrack token'>[</span><span class='@observer_next_event_name_to_observe ivar id'>@observer_next_event_name_to_observe</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
          <span class='@observers_to_set_up ivar id'>@observers_to_set_up</span><span class='lbrack token'>[</span><span class='@observer_next_event_name_to_observe ivar id'>@observer_next_event_name_to_observe</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='name identifier id'>name</span>
          <span class='@observer_next_event_name_to_observe ivar id'>@observer_next_event_name_to_observe</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu May 26 10:00:57 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.1 (ruby-1.8.7).
</div>

  </body>
</html>